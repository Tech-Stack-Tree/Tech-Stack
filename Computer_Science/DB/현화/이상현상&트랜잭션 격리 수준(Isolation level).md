## 이상현상, 트랜잭션 격리 수준(isolation level)

### isolation이 안될 때 나타날 수 있는 여러 현상들
다중 사용자 데이터베이스 환경에서 여러 트랜잭션이 동시에 실행될 때, 서로 다른 트랜잭션 간의 간섭으로 인해 이상현상이 발생할 수 있다. 동시성 제어는 트랜잭션이 올바르게 실행되고 데이터베이스의 무결성을 유지하는데 필수적이다.

#### 1. Dirty read
트랜잭션B가 데이터를 변경하고 커밋하지 않은 시점에서, 트랜잭션 A가 변경된 데이터를 읽어오는 것을 말한다.
이때, 트랜잭션B에 이슈가 발생하여 변경된 데이터를 커밋하지 않고 롤백하는 상황에서 문제가 된다.

#### 2. Non-repeatable read
하나의 트랜잭션 내에서 같은 데이터를 같은 조건으로 여러번 조회했을때, 서로 다른 데이터를 가져오는 것을 말한다.
이는 isolation 관점에서 보면 일어나면 안되는 현상이다.
isolation 속성의 의미는 **'여러 트랜잭션이 동시에 실행되어도, 각각의 트랜잭션은 독립적으로 실행되어야 한다'** 이기 때문

#### 3. Phantom read
하나의 트랜잭션 내에서 같은 조회 쿼리를 두번 실행했을 때, 첫번째 조회 결과에서 없던 레코드가 생성되거나 있었던 레코드가 없어지는 것을 말한다.

#### Non-repeatable read vs Phantom read
- Non-repeatable read는 하나의 레코드의 값이 한 트랜잭션 내에서 다르게 조회될 수 있음
- Phantom read는 하나의 트랜잭션 내에서 조회 쿼리 결과의 레코드 수가 달라질 수 있음을 말한다.

### Isolation level
이상 현상들을 모두 발생하지 않게 만들 수 있지만, 그렇게 하기엔 제약사항이 너무 많아져서 동시 처리 가능한 트랜잭션 수가 줄어들게 된다. 결국 DB 전체 처리량이 하락하게 된다.
때문에 일부 이상 현상은 허용하는 몇 가지 level을 만들어서 사용자가 필요에 따라서 적절하게 선택할 수 있도록 한 것이 **isolation level**이다.

#### 1.Read Uncommitted
- SELECT 문장이 수행되는 동안 해당 데이터에 Shared Lock이 걸리지 않는 계층
- 트랜잭션에 처리중이거나 아직 Commit되지 않은 데이터를 다른 트랜잭션이 읽는 것을 허용함

#### 2. Read Committed
- SELECT 문장이 수행되는 동안 해당 데이터에 Shared Lock이 걸리는 계층
- 트랜잭션이 수행되는 동안 다른 트랜잭션이 접근할 수 없어 대기하게 됨
- Commit이 이루어진 트랜잭션만 조회 가능
- 대부분의 SQL 서버가 Default로 사용하는 Isolation Level임

#### 3. Repeatable Read
- 트랜잭션이 완료될 때까지 SELECT 문장이 사용하는 모든 데이터에 Shared Lock이 걸리는 계층
- 트랜잭션이 범위 내에서 조회한 데이터 내용이 항상 동일함을 보장함
- 다른 사용자는 트랜잭션 영역에 해당되는 데이터에 대한 수정 불가능
- MySQL에서 Default로 사용하는 Isolation level

#### 4.Serializable
- 트랜잭션이 완료될 때까지 SELECT 문장이 사용하는 모든 데이터에 Shared Lock이 걸리는 계층
- 완벽한 읽기 일관성 모드를 제공함
- 다른 사용자는 트랜잭션 영역에 해당되는 데이터에 대한 수정 및 입력 불가능