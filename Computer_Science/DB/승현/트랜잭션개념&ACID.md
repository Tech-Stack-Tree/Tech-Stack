## 💡트랜잭션(Transaction)

DB의 상태를 `변화`시키기 해서 수행하는 작업의 단위를 뜻한다.

데이터의 `정합성` 을 **보장하기 위한 기능**

***정합성** : 데이터들이 **정확히 일치하는 상태**

**데이터의 변화**

- **SELECT**
- **INSERT**
- **DELETE**
- **UPDATE**

→ **질의어(SQL)를 이용하여 DB를 접근하는 것을 말한다.(질의어 한문장이 아니다.)**

ex) 게시판을 예로들어 사용자가 게시글 작성, 올리기 버튼 → 업데이트된 게시판 내용을 보게 된다. Select+Insert 

→ 이러한 작업 단위를 하나의 `트랜잭션`이라고 한다. 

**대용량 데이터 동기화** 등을 처리하다 보면 개발자가 트랜잭션을 어떻게 처리 하느냐에 따라 **데이터의 정합성** 등에 영향을 주게 된다.

## 트랜잭션의 특징(ACID)

- **원자성(Atomicity)**

→ 트랜잭션이 데이터베이스에 `모두 반영`

아니면 `전혀 반영되지 않아야하는 것`

트랜잭션 단위로 데이터가 처리되지 않는다면 → 설계한 사람은 데이터 처리 시스템을 이해하기 힘들 뿐만 아니라 **오작동 했을 시 원인을 찾기 매우 힘들어짐**

- **일관성(Consistency)**

→ 트랜잭션 작업 처리 결과가 항상 `일관성`

트랜잭션이 진행되는 동안에 데이터베이스가 변경 되더라도 업데이트 된 DB로 트랜잭션이 진행되는 것이 아니라, 트랜잭션을 진행 하기 위해 참조한 DB로 진행

- **독립성(Isolation)**

→ 동시에 둘 이상의 트랜잭션이 동시에 실행되고 있을 경우, 어떤 하나의 트랜잭션이라도, 다른 **트랜잭션의 연산에 끼어들 수 없다.**

하나의 트랜잭션이 완료될때까지, 다른 트랜잭션이 특정 트랜잭션의 결과를 참조X

- **지속성(Durability)**

트랜잭션이 성공적으로 완료, 결과는 `영구적`으로 반영되어야 한다는 점

## 트랜잭션의 Commit, Rollback

- **COMMIT**

: 하나의 트랜잭션이 성공적으로 끝났고, 데이터베이스가 **일관성있는** 상태에 있을 때, 하나의 **트랜잭션이 끝났다라는** 것을 알려주기 위해 사용하는 연산

- **ROLLBACK**

: 하나의 트랜잭션 처리가 비정상적으로 종료되어 트랜잭션의 원자성이 깨진 경우, **트랜잭션을 처음부터 다시 시작**하거나 , 트랜잭션의 부분적으로만 **연산된 결과를 다시 취소**시킨다.

- **AUTOCOMMIT**

→ 각각의 쿼리에 자동으로 transaction 처리를 해주는 개념

쿼리가 성공하면 자동으로 commit 한다.

실행중에 문제가 생기면 rollback한다.

MYSQL : default로 autocommit이 enabled 되어 있다.

MYSQL에서 **START TRANSACTION** 실행을 하면 그 동시에 autocommit은 off

COMMIT/ROLLBACK과 함께 transaction이 종료되면 원래 autocommit 상태로 돌아간다.

## 트랜잭션 상태

COMIT과 ROLLBACK은 트랜잭션이 어떤 상태일 때 발생할까?

- **Active(활동)**

: 트랜잭션이 실행 중, 동작 중인 상태

- **Partially Commited(부분완료)**

: 트랜잭션이 실행되고 데이터 변경을 DB에 적용 전 메모리 공간에만 변경해놓은 상태

- **Committed(완료)**

: 트랜잭션이 정상적으로 완료 상태.

실제로 메모리에서 DB에 데이터를 쓴 상태, ROLLBACK 불가능

- **Failed(실패)**

: 오류로 트랜잭션이 실패 상태

- **Aborted(철회)**

: 트랜잭션이 취소 상태. 트랜잭션 실행 이전 데이터로 돌아감

### Reference

https://mommoo.tistory.com/62

https://github.com/devSquad-study/2023-CS-Study/blob/main/DB/db_transaction_and_acid.md
